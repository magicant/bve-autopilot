# bve-autopilot

Bve trainsim 5 用自動運転 ATS プラグインです。現時点では各機能の基本的な動作は一通り実装されています。

- TASC
  - [x] ブレーキの自動制御
  - [x] 計器パネルへの動作状態の表示
- ATO
  - [x] 力行・ブレーキの自動制御
  - [x] 信号速度の順守
  - [x] 制限速度の順守
  - [x] 計器パネルへの動作状態の表示

特定の路線・車両での動作を忠実に再現することよりも、どの路線・車両にも後付けで組み込んで自動運転化できるようなものを目指したいと思っています。

## 動作環境・開発環境

Bve trainsim 5.7.6224.40815 で動作確認しています。BVE4 や OpenBVE のことは知りません。DetailManager からの使用も可能ですが、他の保安装置プラグインとの同時使用については動作未確認です。

このプラグインを修正・改造する場合は最新の Visual Studio の使用を推奨します。

### 非対応車両

- モーターの抵抗制御が手動進段式の車両は非対応です。
- 自動空気ブレーキの車両は非対応です。

### 向かない車両

- ブレーキの応答が遅い車両では停止位置がずれやすくなります。
- 応荷重制御のない車両ではブレーキの制御が不安定になります。
- 電空協調制御のない電気ブレーキを搭載する車両ではブレーキの制御が不安定になります。
- 加速度が 5 km/h/s 以上の車両は加速をやめるタイミングの制御が不安定になります。

## 使用法

プラグイン本体は[リリースページ](https://github.com/magicant/bve-autopilot/releases)からダウンロードできます。また[テスト用シナリオ](https://github.com/magicant/bve-autopilot-scenario)にも含まれています。

自動運転を正常に動作させるためには車両と路線の両方のデータを改造する必要があります。詳しくは [wiki](https://github.com/magicant/bve-autopilot/wiki) を見てください。

### モード切替

[所定のキー操作](https://github.com/magicant/bve-autopilot/wiki/キー操作仕様)によって「ATO と TASC 両方有効」「TASC のみ有効」「どちらも無効」の三つのモードを切り替えることができます。モードによって自動ブレーキの挙動が異なります。

- ATO が有効な時は、列車が停止すると自動的にブレーキがかかります。発進ボタンを押すまで自動ブレーキはかかったままです。
- TASC が有効な時は、駅の停止目標位置付近に停車すると自動的にブレーキがかかります。手動で自動ブレーキ以上のブレーキをかけるかドアが閉まると自動ブレーキは解除されます。
- どちらも無効な時はプラグインによる自動ブレーキは働きません。

## 使用条件

このプラグインの使用条件は [LGPL 2.1](LICENSE) によります。つまり簡単に言うと

* プラグインとして車両データに組み込んで使うのは自由です。
* あなたがこのプラグインを修正・改造したものを公表しようとする場合、バイナリー (dll ファイル) だけでなくソースコードも公開する必要があります。そして公開されたものもまた LGPL に従わなければなりません。
  * せっかく GitHub で開発しているのだから役に立ちそうな修正はプルリクしてください。
